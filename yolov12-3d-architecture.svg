<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="1200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 28px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 16px; fill: #34495e; }
      .layer { font-family: Arial, sans-serif; font-size: 12px; fill: #2c3e50; }
      .output { font-family: Arial, sans-serif; font-size: 11px; fill: #fff; font-weight: bold; }
      .arrow { stroke: #3498db; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-thick { stroke: #3498db; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .box { stroke: #2c3e50; stroke-width: 2; rx: 8; }
      .input-box { fill: #3498db; }
      .backbone-box { fill: #9b59b6; }
      .neck-box { fill: #e67e22; }
      .head-box { fill: #e74c3c; }
      .output-box { fill: #27ae60; }
      .fusion-box { fill: #f39c12; }
      .dim-box { fill: #1abc9c; }
      .loss-2d { fill: #e8f5e9; }
      .loss-3d-loc { fill: #e3f2fd; }
      .loss-3d-shape { fill: #fff3e0; }
      .loss-total { fill: #f3e5f5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">YOLOv12-3D Architecture</text>
  <text x="700" y="70" text-anchor="middle" class="subtitle">3D Object Detection for KITTI Dataset</text>

  <!-- Input -->
  <rect x="50" y="120" width="180" height="100" class="box input-box" />
  <text x="140" y="160" text-anchor="middle" class="output">Input Image</text>
  <text x="140" y="180" text-anchor="middle" class="layer">(640 × 640 × 3)</text>

  <!-- Backbone -->
  <rect x="300" y="90" width="200" height="160" class="box backbone-box" />
  <text x="400" y="120" text-anchor="middle" class="output">BACKBONE</text>
  <text x="400" y="145" text-anchor="middle" class="layer">YOLOv12 Features</text>
  <text x="400" y="165" text-anchor="middle" class="layer">- C3k2 blocks</text>
  <text x="400" y="185" text-anchor="middle" class="layer">- A2C2f blocks</text>
  <text x="400" y="205" text-anchor="middle" class="layer">- Upsampling layers</text>
  <text x="400" y="225" text-anchor="middle" class="layer">Feature Pyramid</text>

  <!-- Arrows from Input to Backbone -->
  <line x1="230" y1="170" x2="300" y2="170" class="arrow" />

  <!-- Neck -->
  <rect x="570" y="110" width="200" height="120" class="box neck-box" />
  <text x="670" y="140" text-anchor="middle" class="output">NECK</text>
  <text x="670" y="165" text-anchor="middle" class="layer">PAN (Path Aggregation)</text>
  <text x="670" y="185" text-anchor="middle" class="layer">Multi-scale Features</text>
  <text x="670" y="205" text-anchor="middle" class="layer">P3, P4, P5 outputs</text>

  <!-- Arrow from Backbone to Neck -->
  <line x1="500" y1="170" x2="570" y2="170" class="arrow" />

  <!-- Detect3D Head -->
  <rect x="840" y="80" width="220" height="200" class="box head-box" />
  <text x="950" y="115" text-anchor="middle" class="output">DETECT3D HEAD</text>
  <text x="950" y="140" text-anchor="middle" class="layer">3D Detection Output</text>

  <!-- Feature fusion -->
  <rect x="865" y="155" width="170" height="25" class="box fusion-box" />
  <text x="950" y="172" text-anchor="middle" class="layer" fill="#fff">Multi-scale Fusion</text>

  <!-- Arrows from Neck to Head -->
  <line x1="770" y1="150" x2="840" y2="150" class="arrow" />
  <line x1="770" y1="170" x2="840" y2="170" class="arrow" />
  <line x1="770" y1="190" x2="840" y2="190" class="arrow" />

  <!-- Output Layer -->
  <rect x="1120" y="80" width="230" height="260" class="box output-box" />
  <text x="1235" y="115" text-anchor="middle" class="output">OUTPUT LAYERS</text>

  <!-- 2D Detection Output -->
  <rect x="1140" y="130" width="190" height="40" class="box" fill="#2ecc71" />
  <text x="1235" y="150" text-anchor="middle" class="layer" fill="#fff">2D Detection</text>
  <text x="1235" y="167" text-anchor="middle" class="layer" fill="#fff">Box (x, y, w, h)</text>

  <!-- 3D Location Output -->
  <rect x="1140" y="180" width="190" height="40" class="box dim-box" />
  <text x="1235" y="200" text-anchor="middle" class="layer" fill="#fff">3D Location</text>
  <text x="1235" y="217" text-anchor="middle" class="layer" fill="#fff">(x, y, z)</text>

  <!-- 3D Dimensions Output -->
  <rect x="1140" y="230" width="190" height="40" class="box dim-box" />
  <text x="1235" y="250" text-anchor="middle" class="layer" fill="#fff">3D Dimensions</text>
  <text x="1235" y="267" text-anchor="middle" class="layer" fill="#fff">(h, w, l)</text>

  <!-- Rotation Output -->
  <rect x="1140" y="280" width="190" height="40" class="box dim-box" />
  <text x="1235" y="300" text-anchor="middle" class="layer" fill="#fff">Rotation</text>
  <text x="1235" y="317" text-anchor="middle" class="layer" fill="#fff">Yaw angle (θ)</text>

  <!-- Class Output -->
  <rect x="1140" y="330" width="190" height="30" class="box" fill="#16a085" />
  <text x="1235" y="348" text-anchor="middle" class="layer" fill="#fff">Class (Car, Pedestrian, etc.)</text>

  <!-- Arrow from Head to Output -->
  <line x1="1060" y1="180" x2="1120" y2="180" class="arrow-thick" />

  <!-- Loss Functions Section -->
  <rect x="50" y="380" width="1300" height="780" class="box" fill="#f8f9fa" stroke="#6c757d" stroke-width="2" />
  <text x="700" y="415" text-anchor="middle" class="subtitle" font-size="22" font-weight="bold">Loss Functions</text>

  <!-- Loss components -->
  <rect x="100" y="440" width="520" height="300" class="box loss-2d" />
  <text x="360" y="475" text-anchor="middle" class="layer" font-size="14" font-weight="bold">2D Detection Loss</text>
  <text x="120" y="500" class="layer">• box_loss (IoU Loss)</text>
  <text x="120" y="525" class="layer">• cls_loss (BCE)</text>
  <text x="120" y="550" class="layer">• dfl_loss (Dist. Focal)</text>
  <text x="120" y="575" class="layer">Improves localization accuracy</text>
  <text x="120" y="600" class="layer">Handles class imbalance</text>
  <text x="120" y="625" class="layer">Enhances boundary prediction</text>
  <text x="120" y="650" class="layer">Smooth training dynamics</text>
  <text x="360" y="685" text-anchor="middle" class="subtitle">Weight: 7.5</text>

  <rect x="650" y="440" width="520" height="300" class="box loss-3d-loc" />
  <text x="910" y="475" text-anchor="middle" class="layer" font-size="14" font-weight="bold">3D Location Loss</text>
  <text x="670" y="500" class="layer">• loc_x_loss (L1)</text>
  <text x="670" y="525" class="layer">• loc_y_loss (L1)</text>
  <text x="670" y="550" class="layer">• depth_loss (L1)</text>
  <text x="670" y="575" class="layer">X, Y: Lateral/vertical position</text>
  <text x="670" y="600" class="layer">Z: Distance from camera</text>
  <text x="670" y="625" class="layer">Normalized to log-space</text>
  <text x="670" y="650" class="layer">Range: [0, 100] meters</text>
  <text x="910" y="685" text-anchor="middle" class="subtitle">Weight: ~6.0</text>

  <rect x="100" y="770" width="520" height="280" class="box loss-3d-shape" />
  <text x="360" y="805" text-anchor="middle" class="layer" font-size="14" font-weight="bold">3D Shape &amp; Rotation Loss</text>
  <text x="120" y="830" class="layer">• dim_loss (L1)</text>
  <text x="120" y="855" class="layer">• rot_loss (Smooth L1)</text>
  <text x="120" y="880" class="layer">Dimensions: height, width, length</text>
  <text x="120" y="905" class="layer">Rotation: encoded as sin(θ), cos(θ)</text>
  <text x="120" y="930" class="layer">Avoids angle discontinuity at π/-π</text>
  <text x="120" y="955" class="layer">Range: [0, π] radians</text>
  <text x="360" y="1015" text-anchor="middle" class="subtitle">Weight: ~4.0</text>

  <rect x="650" y="770" width="520" height="280" class="box loss-total" />
  <text x="910" y="805" text-anchor="middle" class="layer" font-size="14" font-weight="bold">Total Loss</text>
  <text x="670" y="840" class="layer" style="font-size: 18px;">Total = box_loss + cls_loss + dfl_loss</text>
  <text x="670" y="870" class="layer" style="font-size: 18px;">      + loc_x_loss + loc_y_loss + depth_loss</text>
  <text x="670" y="900" class="layer" style="font-size: 18px;">      + dim_loss + rot_loss</text>
  <text x="910" y="950" text-anchor="middle" class="subtitle" style="font-size: 16px; font-weight: bold;">
    Combined with individual weights
  </text>
  <text x="910" y="980" text-anchor="middle" class="subtitle">
    Backpropagated as single scalar
  </text>

  <!-- KITTI IoU Thresholds -->
  <rect x="50" y="1090" width="1300" height="60" class="box" fill="#fffde7" stroke="#fbc02d" stroke-width="2" />
  <text x="700" y="1120" text-anchor="middle" class="subtitle" font-size="16" font-weight="bold">KITTI IoU Thresholds: Car/Truck ≥ 0.7 • Pedestrian/Cyclist ≥ 0.5</text>
  <text x="700" y="1145" text-anchor="middle" class="layer" style="font-size: 13px;">3D IoU computed from projected boxes • Strict matching for KITTI benchmark compliance</text>
</svg>
